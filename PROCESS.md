# Mini Dayz 逆向工程进度记录 (PROCESS.md)

## 当前状态
- **实验目标**: 使用物品 ID `t145` 测试生成功能。
- **环境**: 已启动 Live Server (http://localhost:5500)。
- **主要任务解决**: `test_s.js` 的脚本逻辑优化及浏览器内实机测试。

## 进度清单
1. [x] **项目文件初步研究**: 完成了 `TASKS.md`, `test_s.js`, `c2runtime.js`, `data.js` 的分析。
2. [/] **脚本优化**:
   - [x] 确认目标物品 ID 为 `t148` (Carbine)。
   - [x] 分析混淆映射：`instances` -> `q`, `createInstance` -> `TF` (待验证), `types_by_index` -> `runtime.types`。
   - [x] 开发启发式查找玩家和图层的逻辑。
3. [/] **实机测试与调试**:
   - [x] 成功运行本地服务器并加载游戏环境。
   - [x] 在浏览器控制台执行 `test_s.js` 脚本。
   - [!] **实机反馈**: 用户反馈脚本运行后物品并未在游戏中出现。
   - [ ] **待办**: 通过实时断点或对象检查，验证 `TF` 函数的参数和执行结果。

## 关键发现
- **引擎**: Construct 2。
- **混淆**: 变量名极度压缩（如 `q`, `TF`）。
- **数据结构**: `data.js` 定义了所有 `tN` 开头的对象原型。
- **当前瓶颈**: `runtime.TF` 可能并非生成实例的唯一或正确函数，或者生成的图层/坐标存在问题。

## 详细日志 (2025-01-16)
- **分析过程**: 针对 `c2runtime.js` 进行静态代码走查，推断出实例数组 `instances` 为 `q`，生成函数为 `TF`。
- **尝试逻辑**: `test_s.js` 解析玩家坐标后，调用 `runtime.TF(type, layer, x, y)`。
- **实机失败记录**: 脚本报告成功，但游戏画面中无视觉表现。
- **原因深入排查**:
    1. **层级问题 (Layer)**: 生成的层级可能被玩家所在层级遮挡，或位于一个不可见的容器中。
    2. **初始化缺失**: 某些物品实例需要调用特定的初始化方法（如行为初始化）才能正确渲染。
    3. **坐标系统**: 验证 `x, y` 是否为世界坐标而非屏幕坐标，目前脚本使用了 `player.x`，方向大概率正确，但需确认。
    4. **函数误判**: 核心疑点在于 `TF` 是否真的是 `createInstance`。C2 引擎中 `createInstance` 负责分配内存并添加到实例列表，如果调用了错误的混淆函数，可能导致数据不完整。
